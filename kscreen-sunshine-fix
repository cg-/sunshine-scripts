#!/bin/bash
LOG="/tmp/sunshine-script.log"
echo "$(date): W=$W H=$H R=$R" >> $LOG
W=$SUNSHINE_CLIENT_WIDTH H=$SUNSHINE_CLIENT_HEIGHT R=$SUNSHINE_CLIENT_FPS

# Use xrandr --mode (stable names, no ID shift)
case "$W x $H" in
  "3840 x 2160") MODE="3840x2160@60" ;;
  "2560 x 1440") MODE="2560x1440@60" ;;
  "1920 x 1080") MODE="1920x1080@120" ;;
  "1280 x 720") MODE="1280x720@60" ;;
  "2560 x 1600") MODE="2560x1600@60" ;;
  "1920 x 1200") MODE="1920x1200@60" ;;
  "1680 x 1050") MODE="1680x1050@60" ;;
  "1440 x 900") MODE="1440x900@60" ;;
  "1280 x 800") MODE="1280x800@60" ;;
  *) MODE="1920x1080@120" ;;
esac

echo "$(date): $W x $H â†’ xrandr --mode $MODE" >> $LOG
xrandr --output HDMI-A-3 --primary --mode "$MODE" --pos 0x0
kscreen-doctor output.HDMI-A-3.primary output.DP-3.disable output.DP-1.disable >> $LOG 2>&1
echo "$(date): $(xrandr | grep HDMI-A-3)" >> $LOG
tail -n 100 "$LOG" > "${LOG}.tmp" && mv "${LOG}.tmp" "$LOG"

